<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Redux App</title>
    <meta charset="utf-8" />
    <style>
      body {
        margin: 0;
        height: 100vh;

        display: flex;
        justify-content: center;
        align-items: center;
      }

      body.dark {
        background-color: darkslategrey;
        color: white;
      }

      body.light {
        background-color: papayawhip;
        color: black;
      }
    </style>
  </head>
  <body class="light">
    <main>
      <label>
        Dark mode?
        <input id="dark-mode-cb" type="checkbox" />
      </label>
      <div>
        <button id="inc-btn">Increment</button>
        <div id="count">0</div>
        <button id="dec-btn">Decrement</button>
      </div>
    </main>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.5/redux.min.js"
      integrity="sha256-7nQo8jg3+LLQfXy/aqP5D6XtqDQRODTO18xBdHhQow4="
      crossorigin="anonymous"
    ></script>
    <script>
      // store - single place to keep the state
      // actions - how we indicate that something happened
      // reducer - function. (currentState, action) => nextState. "getNextState"

      // actions?

      // INCREMENT_COUNT - { type: 'inc' }
      // DECREMENT_COUNT - { type: 'dec' }
      // TOGGLE_DARK_MODE_ON - { type: 'dark-mode' }
      // TOGGLE_DARK_MODE_OFF - { type: 'light-mode' }

      /**
       * Interface State {
       *   count: number;
       *   theme: 'dark' | 'light';
       * }
       */

      // aka reducer
      function getNextState(currentState, action) {
        switch (action.type) {
          case 'inc':
            return {
              ...currentState,
              count: currentState.count + 1,
            }
          case 'dec':
            return {
              ...currentState,
              count: currentState.count - 1,
            }
          case 'dark-mode':
            return {
              ...currentState,
              theme: 'dark',
            }
          case 'light-mode':
            return {
              ...currentState,
              theme: 'light',
            }
          default:
            return currentState
        }
      }

      const initialState = { count: 0, theme: 'light' }
      const store = Redux.createStore(getNextState, initialState)

      const incBtnEl = document.getElementById('inc-btn')
      const decBtnEl = document.getElementById('dec-btn')

      incBtnEl.addEventListener('click', () => {
        store.dispatch({ type: 'inc' })
      })

      decBtnEl.addEventListener('click', () => {
        store.dispatch({ type: 'dec' })
      })

      const darkModeCbEl = document.getElementById('dark-mode-cb')
      darkModeCbEl.addEventListener('change', event => {
        if (event.target.checked) {
          store.dispatch({ type: 'dark-mode' })
        } else {
          store.dispatch({ type: 'light-mode' })
        }
      })

      const countEl = document.getElementById('count')

      store.subscribe(() => {
        const state = store.getState()

        // update the count UI
        countEl.innerText = state.count

        // update the them UI
        document.body.classList.remove('dark', 'light')
        document.body.classList.add(state.theme)
      })
    </script>
  </body>
</html>
